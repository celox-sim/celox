import{_ as i,o as a,c as t,ae as n}from"./chunks/framework.Dk94_bKO.js";const c=JSON.parse('{"title":"Vite プラグイン","description":"","frontmatter":{},"headers":[],"relativePath":"ja/guide/vite-plugin.md","filePath":"ja/guide/vite-plugin.md"}'),e={name:"ja/guide/vite-plugin.md"};function l(p,s,h,o,d,k){return a(),t("div",null,[...s[0]||(s[0]=[n(`<h1 id="vite-プラグイン" tabindex="-1">Vite プラグイン <a class="header-anchor" href="#vite-プラグイン" aria-label="Permalink to &quot;Vite プラグイン&quot;">​</a></h1><p><code>@celox-sim/vite-plugin</code> パッケージは、Veryl ソースファイルと TypeScript/Vitest ツールチェーンのシームレスな統合を提供します。</p><h2 id="機能" tabindex="-1">機能 <a class="header-anchor" href="#機能" aria-label="Permalink to &quot;機能&quot;">​</a></h2><p>プラグインは 3 つのことを自動的に処理します：</p><ol><li><strong>モジュール解決</strong> -- テストファイルで <code>import { Counter } from &quot;../src/Counter.veryl&quot;</code> が動作するようにします。</li><li><strong>型生成</strong> -- TypeScript が各モジュールの形状（ポート、イベント、型）を理解できるように <code>.d.veryl.ts</code> サイドカーファイルを生成します。</li><li><strong>ホットリロード</strong> -- <code>.veryl</code> ファイルが変更されると、プラグインはキャッシュを無効化して型を再生成します。</li></ol><p>内部的には、プラグインは NAPI アドオンを介して <code>celox-ts-gen</code> 型ジェネレータを呼び出します。ジェネレータを手動で実行する必要はありません。</p><h2 id="インストール" tabindex="-1">インストール <a class="header-anchor" href="#インストール" aria-label="Permalink to &quot;インストール&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> add</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -D</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> @celox-sim/vite-plugin</span></span></code></pre></div><h2 id="設定" tabindex="-1">設定 <a class="header-anchor" href="#設定" aria-label="Permalink to &quot;設定&quot;">​</a></h2><h3 id="基本設定" tabindex="-1">基本設定 <a class="header-anchor" href="#基本設定" aria-label="Permalink to &quot;基本設定&quot;">​</a></h3><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// vitest.config.ts</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { defineConfig } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;vitest/config&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> celox </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;@celox-sim/vite-plugin&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> defineConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  plugins: [</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">celox</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre></div><p>プラグインは Vite プロジェクトルートから上方に探索して、最も近い <code>Veryl.toml</code> を自動的に見つけます。</p><h3 id="カスタムプロジェクトルート" tabindex="-1">カスタムプロジェクトルート <a class="header-anchor" href="#カスタムプロジェクトルート" aria-label="Permalink to &quot;カスタムプロジェクトルート&quot;">​</a></h3><p><code>Veryl.toml</code> が Vite ルートまたはその親ディレクトリにない場合、パスを明示的に指定します：</p><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> defineConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  plugins: [</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    celox</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      projectRoot: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;./path/to/veryl-project&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre></div><h3 id="tsconfig-json" tabindex="-1">tsconfig.json <a class="header-anchor" href="#tsconfig-json" aria-label="Permalink to &quot;tsconfig.json&quot;">​</a></h3><p><code>.veryl</code> インポートの TypeScript サポートを有効にするには、<code>tsconfig.json</code> に以下を追加します：</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;compilerOptions&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;allowArbitraryExtensions&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;rootDirs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;src&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;.celox/src&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;include&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;test&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;src&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;.celox/src&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><ul><li><code>allowArbitraryExtensions</code> は TypeScript が <code>.d.veryl.ts</code> ファイルを解決できるようにします。</li><li><code>rootDirs</code> は TypeScript に <code>.celox/</code> サイドカーディレクトリをソースツリーの仮想オーバーレイとして扱うように指示します。</li></ul><h2 id="生成されるファイル" tabindex="-1">生成されるファイル <a class="header-anchor" href="#生成されるファイル" aria-label="Permalink to &quot;生成されるファイル&quot;">​</a></h2><p>プラグインはソースツリーをミラーリングして <code>.celox/</code> ディレクトリにサイドカーファイルを生成します：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>my-project/</span></span>
<span class="line"><span>├── src/</span></span>
<span class="line"><span>│   └── Counter.veryl          # Veryl ソース</span></span>
<span class="line"><span>├── .celox/</span></span>
<span class="line"><span>│   └── src/</span></span>
<span class="line"><span>│       └── Counter.d.veryl.ts # 生成された型定義</span></span>
<span class="line"><span>└── vitest.config.ts</span></span></code></pre></div><p><code>.celox/</code> を <code>.gitignore</code> に追加してください：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>.celox/</span></span></code></pre></div><h2 id="オプション" tabindex="-1">オプション <a class="header-anchor" href="#オプション" aria-label="Permalink to &quot;オプション&quot;">​</a></h2><table tabindex="0"><thead><tr><th>オプション</th><th>型</th><th>デフォルト</th><th>説明</th></tr></thead><tbody><tr><td><code>projectRoot</code></td><td><code>string</code></td><td><em>（自動検出）</em></td><td><code>Veryl.toml</code> を含むディレクトリへのパス</td></tr></tbody></table>`,26)])])}const E=i(e,[["render",l]]);export{c as __pageData,E as default};
