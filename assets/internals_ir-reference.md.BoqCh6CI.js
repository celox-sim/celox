import{_ as s,o as t,c as e,ae as a}from"./chunks/framework.Dk94_bKO.js";const c=JSON.parse('{"title":"SIR Intermediate Representation Reference","description":"","frontmatter":{},"headers":[],"relativePath":"internals/ir-reference.md","filePath":"internals/ir-reference.md"}'),n={name:"internals/ir-reference.md"};function l(r,i,h,d,o,k){return t(),e("div",null,[...i[0]||(i[0]=[a(`<h1 id="sir-intermediate-representation-reference" tabindex="-1">SIR Intermediate Representation Reference <a class="header-anchor" href="#sir-intermediate-representation-reference" aria-label="Permalink to &quot;SIR Intermediate Representation Reference&quot;">​</a></h1><p>SIR (Simulator Intermediate Representation) is the execution IR for Celox. It lowers Veryl analysis results into a register-based instruction sequence that serves as input to the Cranelift JIT.</p><h2 id="overview" tabindex="-1">Overview <a class="header-anchor" href="#overview" aria-label="Permalink to &quot;Overview&quot;">​</a></h2><ul><li><strong>Register-based</strong>: SSA-like representation using virtual registers (<code>RegisterId</code>)</li><li><strong>CFG representation</strong>: Control flow via <code>BasicBlock</code> + <code>SIRTerminator</code></li><li><strong>Region-qualified memory</strong>: Bit-precision access through <code>RegionedAbsoluteAddr</code> and <code>SIROffset</code></li></ul><h2 id="address-system" tabindex="-1">Address System <a class="header-anchor" href="#address-system" aria-label="Permalink to &quot;Address System&quot;">​</a></h2><table tabindex="0"><thead><tr><th style="text-align:left;">Type</th><th style="text-align:left;">Purpose</th><th style="text-align:left;">Stage</th></tr></thead><tbody><tr><td style="text-align:left;"><code>VarId</code></td><td style="text-align:left;">Module-local variable ID</td><td style="text-align:left;">Within <code>SimModule</code></td></tr><tr><td style="text-align:left;"><code>AbsoluteAddr</code></td><td style="text-align:left;">Global variable (<code>InstanceId</code> + <code>VarId</code>)</td><td style="text-align:left;">After flattening</td></tr><tr><td style="text-align:left;"><code>RegionedAbsoluteAddr</code></td><td style="text-align:left;">Address with memory region (Stable/Working) qualifier</td><td style="text-align:left;">Execution/optimization</td></tr><tr><td style="text-align:left;"><code>SignalRef</code></td><td style="text-align:left;">Physical memory address handle for execution</td><td style="text-align:left;">Execution (fast access)</td></tr></tbody></table><h2 id="key-data-structures" tabindex="-1">Key Data Structures <a class="header-anchor" href="#key-data-structures" aria-label="Permalink to &quot;Key Data Structures&quot;">​</a></h2><h3 id="program" tabindex="-1"><code>Program</code> <a class="header-anchor" href="#program" aria-label="Permalink to &quot;\`Program\`&quot;">​</a></h3><p>A struct representing the entire simulation. A notable characteristic is that flip-flop evaluation is split into three variants.</p><div class="language-rust vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">pub</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> struct</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Program</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    pub</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> eval_apply_ffs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> HashMap</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">AbsoluteAddr</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Vec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ExecutionUnit</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">RegionedAbsoluteAddr</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;&gt;&gt;,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    pub</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> eval_only_ffs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> HashMap</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">AbsoluteAddr</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Vec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ExecutionUnit</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">RegionedAbsoluteAddr</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;&gt;&gt;,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    pub</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> apply_ffs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> HashMap</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">AbsoluteAddr</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Vec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ExecutionUnit</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">RegionedAbsoluteAddr</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;&gt;&gt;,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    pub</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> eval_comb</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Vec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ExecutionUnit</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">RegionedAbsoluteAddr</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;&gt;,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // ... other metadata</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><ul><li><strong><code>eval_apply_ffs</code></strong>: Standard synchronous flip-flop evaluation. Used when operating in a single domain.</li><li><strong><code>eval_only_ffs</code></strong>: Phase that only computes the next state and writes it to the Working region.</li><li><strong><code>apply_ffs</code></strong>: Phase that commits values from the Working region to the Stable region.</li></ul><h3 id="executionunit" tabindex="-1"><code>ExecutionUnit</code> <a class="header-anchor" href="#executionunit" aria-label="Permalink to &quot;\`ExecutionUnit\`&quot;">​</a></h3><p>The smallest unit of execution.</p><div class="language-rust vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">pub</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> struct</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ExecutionUnit</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">A</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    pub</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> entry_block_id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> BlockId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    pub</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> blocks</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> HashMap</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">BlockId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">BasicBlock</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">A</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;&gt;,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    pub</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> register_map</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> HashMap</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">RegisterId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">RegisterType</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h2 id="instruction-set" tabindex="-1">Instruction Set <a class="header-anchor" href="#instruction-set" aria-label="Permalink to &quot;Instruction Set&quot;">​</a></h2><ul><li><code>Imm(rd, value)</code>: Immediate value assignment</li><li><code>Binary(rd, rs1, op, rs2)</code>: Binary operation</li><li><code>Unary(rd, op, rs)</code>: Unary operation</li><li><code>Load(rd, addr, offset, bits)</code>: Memory load</li><li><code>Store(addr, offset, bits, rs)</code>: Memory store (RMW)</li><li><code>Commit(src, dst, offset, bits)</code>: Cross-region copy</li><li><code>Concat(rd, [msb..lsb])</code>: Register concatenation</li></ul><h2 id="control-flow" tabindex="-1">Control Flow <a class="header-anchor" href="#control-flow" aria-label="Permalink to &quot;Control Flow&quot;">​</a></h2><ul><li><code>Jump(block_id, args)</code>: Unconditional branch (with block arguments)</li><li><code>Branch { cond, true_block, false_block }</code>: Conditional branch</li><li><code>Return</code>: End of execution</li><li><code>Error(code)</code>: Runtime error</li></ul>`,18)])])}const g=s(n,[["render",l]]);export{c as __pageData,g as default};
