<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>TypeScript テストベンチ — 目指す体験 | Celox</title>
    <meta name="description" content="JIT simulator for Veryl HDL">
    <meta name="generator" content="VitePress v1.6.4">
    <link rel="preload stylesheet" href="/celox/assets/style.BL6DWorK.css" as="style">
    <link rel="preload stylesheet" href="/celox/vp-icons.css" as="style">
    
    <script type="module" src="/celox/assets/app.CTVM9efA.js"></script>
    <link rel="preload" href="/celox/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/celox/assets/chunks/theme.CIS4rXTU.js">
    <link rel="modulepreload" href="/celox/assets/chunks/framework.Dk94_bKO.js">
    <link rel="modulepreload" href="/celox/assets/ts_testbench_vision.md.CnKJOe6s.lean.js">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"dark",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-78e6fd13><!--[--><!--]--><!--[--><span tabindex="-1" data-v-1cd3b672></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-1cd3b672>Skip to content</a><!--]--><!----><header class="VPNav" data-v-78e6fd13 data-v-17b4c5ed><div class="VPNavBar" data-v-17b4c5ed data-v-2bc63d22><div class="wrapper" data-v-2bc63d22><div class="container" data-v-2bc63d22><div class="title" data-v-2bc63d22><div class="VPNavBarTitle" data-v-2bc63d22 data-v-7f23c66b><a class="title" href="/celox/" data-v-7f23c66b><!--[--><!--]--><!----><span data-v-7f23c66b>Celox</span><!--[--><!--]--></a></div></div><div class="content" data-v-2bc63d22><div class="content-body" data-v-2bc63d22><!--[--><!--]--><div class="VPNavBarSearch search" data-v-2bc63d22><!----></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-2bc63d22 data-v-30290ed5><span id="main-nav-aria-label" class="visually-hidden" data-v-30290ed5> Main Navigation </span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/celox/guide/introduction.html" tabindex="0" data-v-30290ed5 data-v-b9f4c034><!--[--><span data-v-b9f4c034>Guide</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/celox/api/" tabindex="0" data-v-30290ed5 data-v-b9f4c034><!--[--><span data-v-b9f4c034>API</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/celox/internals/architecture.html" tabindex="0" data-v-30290ed5 data-v-b9f4c034><!--[--><span data-v-b9f4c034>Internals</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/celox/benchmarks/" tabindex="0" data-v-30290ed5 data-v-b9f4c034><!--[--><span data-v-b9f4c034>Benchmarks</span><!--]--></a><!--]--><!--[--><a class="VPLink link vp-external-link-icon VPNavBarMenuLink" href="https://github.com/celox-sim/celox" target="_blank" rel="noreferrer" tabindex="0" data-v-30290ed5 data-v-b9f4c034><!--[--><span data-v-b9f4c034>GitHub</span><!--]--></a><!--]--><!--]--></nav><div class="VPFlyout VPNavBarTranslations translations" data-v-2bc63d22 data-v-7aa4ad2b data-v-d547690c><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="Change language" data-v-d547690c><span class="text" data-v-d547690c><span class="vpi-languages option-icon" data-v-d547690c></span><!----><span class="vpi-chevron-down text-icon" data-v-d547690c></span></span></button><div class="menu" data-v-d547690c><div class="VPMenu" data-v-d547690c data-v-a4e30ba5><!----><!--[--><!--[--><div class="items" data-v-7aa4ad2b><p class="title" data-v-7aa4ad2b>English</p><!--[--><div class="VPMenuLink" data-v-7aa4ad2b data-v-54835435><a class="VPLink link" href="/celox/ja/ts_testbench_vision.html" data-v-54835435><!--[--><span data-v-54835435>Japanese</span><!--]--></a></div><!--]--></div><!--]--><!--]--></div></div></div><div class="VPNavBarAppearance appearance" data-v-2bc63d22 data-v-2b9118fd><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="true" data-v-2b9118fd data-v-f97dd99a data-v-674b6c6b><span class="check" data-v-674b6c6b><span class="icon" data-v-674b6c6b><!--[--><span class="vpi-sun sun" data-v-f97dd99a></span><span class="vpi-moon moon" data-v-f97dd99a></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-2bc63d22 data-v-a6c2ce62 data-v-789d7690><!--[--><a class="VPSocialLink no-icon" href="https://github.com/celox-sim/celox" aria-label="github" target="_blank" rel="noopener" data-v-789d7690 data-v-3778120c><span class="vpi-social-github"></span></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-2bc63d22 data-v-cb87d0cc data-v-d547690c><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-d547690c><span class="vpi-more-horizontal icon" data-v-d547690c></span></button><div class="menu" data-v-d547690c><div class="VPMenu" data-v-d547690c data-v-a4e30ba5><!----><!--[--><!--[--><div class="group translations" data-v-cb87d0cc><p class="trans-title" data-v-cb87d0cc>English</p><!--[--><div class="VPMenuLink" data-v-cb87d0cc data-v-54835435><a class="VPLink link" href="/celox/ja/ts_testbench_vision.html" data-v-54835435><!--[--><span data-v-54835435>Japanese</span><!--]--></a></div><!--]--></div><div class="group" data-v-cb87d0cc><div class="item appearance" data-v-cb87d0cc><p class="label" data-v-cb87d0cc>Appearance</p><div class="appearance-action" data-v-cb87d0cc><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="true" data-v-cb87d0cc data-v-f97dd99a data-v-674b6c6b><span class="check" data-v-674b6c6b><span class="icon" data-v-674b6c6b><!--[--><span class="vpi-sun sun" data-v-f97dd99a></span><span class="vpi-moon moon" data-v-f97dd99a></span><!--]--></span></span></button></div></div></div><div class="group" data-v-cb87d0cc><div class="item social-links" data-v-cb87d0cc><div class="VPSocialLinks social-links-list" data-v-cb87d0cc data-v-789d7690><!--[--><a class="VPSocialLink no-icon" href="https://github.com/celox-sim/celox" aria-label="github" target="_blank" rel="noopener" data-v-789d7690 data-v-3778120c><span class="vpi-social-github"></span></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-2bc63d22 data-v-554d65f5><span class="container" data-v-554d65f5><span class="top" data-v-554d65f5></span><span class="middle" data-v-554d65f5></span><span class="bottom" data-v-554d65f5></span></span></button></div></div></div></div><div class="divider" data-v-2bc63d22><div class="divider-line" data-v-2bc63d22></div></div></div><!----></header><div class="VPLocalNav empty fixed" data-v-78e6fd13 data-v-7c6a6c5c><div class="container" data-v-7c6a6c5c><!----><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-7c6a6c5c data-v-7fbe56ad><button data-v-7fbe56ad>Return to top</button><!----></div></div></div><!----><div class="VPContent" id="VPContent" data-v-78e6fd13 data-v-b96f5c59><div class="VPDoc has-aside" data-v-b96f5c59 data-v-f11b51ce><!--[--><!--]--><div class="container" data-v-f11b51ce><div class="aside" data-v-f11b51ce><div class="aside-curtain" data-v-f11b51ce></div><div class="aside-container" data-v-f11b51ce><div class="aside-content" data-v-f11b51ce><div class="VPDocAside" data-v-f11b51ce data-v-af4dcdc7><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-af4dcdc7 data-v-a2659a06><div class="content" data-v-a2659a06><div class="outline-marker" data-v-a2659a06></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-a2659a06>On this page</div><ul class="VPDocOutlineItem root" data-v-a2659a06 data-v-acb09b19><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-af4dcdc7></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-f11b51ce><div class="content-container" data-v-f11b51ce><!--[--><!--]--><main class="main" data-v-f11b51ce><div style="position:relative;" class="vp-doc _celox_ts_testbench_vision" data-v-f11b51ce><div><h1 id="typescript-テストベンチ-—-目指す体験" tabindex="-1">TypeScript テストベンチ — 目指す体験 <a class="header-anchor" href="#typescript-テストベンチ-—-目指す体験" aria-label="Permalink to &quot;TypeScript テストベンチ — 目指す体験&quot;">​</a></h1><h2 id="背景と動機" tabindex="-1">背景と動機 <a class="header-anchor" href="#背景と動機" aria-label="Permalink to &quot;背景と動機&quot;">​</a></h2><p>現在の Veryl シミュレータは Rust API を提供しており、<code>simulator-macros</code> クレートの proc macro によって Veryl モジュール定義から型安全なアクセサを自動生成している。この体験は強力だが、Rust のコンパイル時間やボイラープレートが検証の反復速度を制約する場面がある。</p><p>TypeScript には以下の抗えない強みがある:</p><ol><li><strong>型システム + import による自動生成</strong>: <code>.veryl</code> ファイルから <code>.d.ts</code> 型定義を生成すれば、<code>import</code> した瞬間にポート名・ビット幅・型が補完される。ユーザーが意識せずとも型安全が実現する</li><li><strong>Python より速い可能性</strong>: V8/Bun の JIT コンパイルにより、テストベンチのオーケストレーション層は Python (cocotb 等) より高速に動作しうる</li><li><strong>即座のフィードバック</strong>: コンパイル不要で <code>bun test</code> や <code>vitest</code> で即座に実行可能。ホットリロードも活用できる</li><li><strong>圧倒的な IDE 体験</strong>: VS Code の TypeScript サポートにより、ポート名補完・型エラー・リファクタリングが最初から動く</li></ol><h2 id="目指す体験" tabindex="-1">目指す体験 <a class="header-anchor" href="#目指す体験" aria-label="Permalink to &quot;目指す体験&quot;">​</a></h2><h3 id="_1-import-するだけで型が付く" tabindex="-1">1. import するだけで型が付く <a class="header-anchor" href="#_1-import-するだけで型が付く" aria-label="Permalink to &quot;1. import するだけで型が付く&quot;">​</a></h3><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Veryl モジュール定義から型が自動生成される</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { Adder } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;./Adder.veryl&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Adder の型情報:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//   clk: clock</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//   rst: reset</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//   a: input logic&lt;16&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//   b: input logic&lt;16&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//   sum: output logic&lt;17&gt;</span></span></code></pre></div><p>ユーザーは <code>.veryl</code> ファイルを import するだけで、そのモジュールのポート定義が TypeScript の型として利用可能になる。手動で型定義を書く必要はない。</p><h3 id="_2-直感的な-dut-操作" tabindex="-1">2. 直感的な DUT 操作 <a class="header-anchor" href="#_2-直感的な-dut-操作" aria-label="Permalink to &quot;2. 直感的な DUT 操作&quot;">​</a></h3><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { Simulator } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;@veryl-lang/simulator&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { Adder } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;./Adder.veryl&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> sim</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Simulator.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">create</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Adder);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> dut</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sim.dut;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// プロパティ代入でポート値を設定（型チェック付き）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">dut.a </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 100</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">dut.b </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 200</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// tick でクロックを進める</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sim.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tick</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// プロパティ参照で出力を取得</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(dut.sum); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// =&gt; 300</span></span></code></pre></div><h4 id="設計原則" tabindex="-1">設計原則 <a class="header-anchor" href="#設計原則" aria-label="Permalink to &quot;設計原則&quot;">​</a></h4><ul><li><strong>プロパティアクセス</strong>: <code>dut.a = 100</code> / <code>dut.sum</code> — <code>set_a()</code> / <code>get_sum()</code> のような冗長な API は避ける</li><li><strong>型によるビット幅保証</strong>: <code>logic&lt;8&gt;</code> のポートに <code>256</code> を代入すると型エラーまたはランタイムエラー</li><li><strong>await で時間の進行を明示</strong>: <code>await sim.tick()</code> は非同期で、将来的な波形ストリーミングやデバッガ連携に対応しやすい</li></ul><h3 id="_3-テストフレームワーク統合" tabindex="-1">3. テストフレームワーク統合 <a class="header-anchor" href="#_3-テストフレームワーク統合" aria-label="Permalink to &quot;3. テストフレームワーク統合&quot;">​</a></h3><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { describe, test, expect } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;vitest&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { Simulator } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;@veryl-lang/simulator&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { Counter } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;./Counter.veryl&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">describe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Counter&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  test</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;counts up on each clock edge&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> sim</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Simulator.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">create</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Counter);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> dut</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sim.dut;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    dut.rst </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sim.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tick</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    expect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(dut.count).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toBe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    dut.rst </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sim.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tick</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    expect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(dut.count).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toBe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sim.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tick</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    expect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(dut.count).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toBe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  test</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;resets to zero&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> sim</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Simulator.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">create</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Counter);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> dut</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sim.dut;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    dut.rst </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sim.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tick</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 5 サイクル進める</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    expect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(dut.count).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toBe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    dut.rst </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sim.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tick</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    expect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(dut.count).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toBe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre></div><ul><li>vitest / Jest / Bun test など、既存の JS テストランナーがそのまま使える</li><li>新しいテストフレームワークを学ぶ必要がない</li><li>CI/CD パイプラインに自然に統合できる</li></ul><h3 id="_4-マルチクロック・高度な制御" tabindex="-1">4. マルチクロック・高度な制御 <a class="header-anchor" href="#_4-マルチクロック・高度な制御" aria-label="Permalink to &quot;4. マルチクロック・高度な制御&quot;">​</a></h3><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> sim</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Simulator.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">create</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(DualClockFIFO);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> dut</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sim.dut;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 名前付きクロックの明示的操作</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> wrClk</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sim.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">event</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;wr_clk&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> rdClk</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sim.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">event</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;rd_clk&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">dut.wr_data </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0xAB</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">dut.wr_en </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sim.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tick</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(wrClk);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">dut.rd_en </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sim.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tick</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(rdClk);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">expect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(dut.rd_data).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toBe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0xAB</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 時間ベースシミュレーション</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> sim</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Simulation.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">create</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Top);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">sim.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">addClock</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;clk&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, { period: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">sim.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">schedule</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;rst&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, { time: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, value: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sim.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">runUntil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">100</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">expect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(sim.dut.q).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toBe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(expectedValue);</span></span></code></pre></div><h3 id="_5-4-state-x-z-サポート" tabindex="-1">5. 4-state (X/Z) サポート <a class="header-anchor" href="#_5-4-state-x-z-サポート" aria-label="Permalink to &quot;5. 4-state (X/Z) サポート&quot;">​</a></h3><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { X, Z, FourState } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;@veryl-lang/simulator&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> sim</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Simulator.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">create</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Top, { fourState: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> });</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> dut</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sim.dut;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// X/Z を明示的に設定</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">dut.a </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> X</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;                    </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 全ビット X</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">dut.b </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> FourState</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0b1010</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0b0100</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ビット 2 が X</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// X/Z の検査</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">expect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(dut.y).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toBeX</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();       </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// カスタムマッチャー</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">expect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(dut.y).not.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toBeZ</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ビットレベルの検査</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">mask</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sim.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getFourState</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(dut.ref.y);</span></span></code></pre></div><h3 id="_6-波形ダンプ" tabindex="-1">6. 波形ダンプ <a class="header-anchor" href="#_6-波形ダンプ" aria-label="Permalink to &quot;6. 波形ダンプ&quot;">​</a></h3><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> sim</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Simulator.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">create</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Top, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  vcd: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;./output.vcd&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,   </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// VCD 自動出力</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// テスト実行中の全信号変化が記録される</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">dut.a </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sim.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tick</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">dut.a </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sim.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tick</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">sim.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">dispose</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ファイルをフラッシュして閉じる</span></span></code></pre></div><h3 id="_7-階層アクセスとインターフェース" tabindex="-1">7. 階層アクセスとインターフェース <a class="header-anchor" href="#_7-階層アクセスとインターフェース" aria-label="Permalink to &quot;7. 階層アクセスとインターフェース&quot;">​</a></h3><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { TopModule } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;./Top.veryl&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> sim</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Simulator.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">create</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(TopModule);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> dut</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sim.dut;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// フラットなトップレベルポート</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">dut.globalReset </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// インターフェースのメンバーアクセス</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">dut.bus.addr </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0x1000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">dut.bus.data </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0xFF</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">dut.bus.valid </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sim.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tick</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">expect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(dut.bus.ready).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toBe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><h3 id="_8-配列ポート" tabindex="-1">8. 配列ポート <a class="header-anchor" href="#_8-配列ポート" aria-label="Permalink to &quot;8. 配列ポート&quot;">​</a></h3><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { MemoryBank } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;./MemoryBank.veryl&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> sim</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Simulator.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">create</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(MemoryBank);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> dut</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sim.dut;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 配列はインデックスアクセス</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">dut.data[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0xAA</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">dut.data[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0xBB</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sim.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tick</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">expect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(dut.out[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toBe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0xAA</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><h3 id="_9-wide-64-bit-値" tabindex="-1">9. Wide (&gt;64-bit) 値 <a class="header-anchor" href="#_9-wide-64-bit-値" aria-label="Permalink to &quot;9. Wide (&gt;64-bit) 値&quot;">​</a></h3><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// BigInt でシームレスに扱う</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">dut.widePort </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0x1234_5678_9ABC_DEF0_1234_5678</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">n</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sim.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tick</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">expect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(dut.wideOutput).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toBe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(expectedBigInt);</span></span></code></pre></div><p>TypeScript は <code>BigInt</code> をネイティブサポートしているため、Rust の <code>BigUint</code> と同様に任意幅の値を自然に扱える。</p><h2 id="型生成の仕組み-構想" tabindex="-1">型生成の仕組み（構想） <a class="header-anchor" href="#型生成の仕組み-構想" aria-label="Permalink to &quot;型生成の仕組み（構想）&quot;">​</a></h2><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Veryl ソース (.veryl)</span></span>
<span class="line"><span>  → veryl analyze (既存の Analyzer + IR)</span></span>
<span class="line"><span>  → TypeScript 型定義生成器</span></span>
<span class="line"><span>  → .d.ts ファイル + .js シム (NAPI/WASM 経由で Cranelift バックエンドを呼ぶ)</span></span></code></pre></div><h3 id="生成される型の例" tabindex="-1">生成される型の例 <a class="header-anchor" href="#生成される型の例" aria-label="Permalink to &quot;生成される型の例&quot;">​</a></h3><div class="language-veryl vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">veryl</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>module Adder (</span></span>
<span class="line"><span>    clk: input  clock,</span></span>
<span class="line"><span>    rst: input  reset,</span></span>
<span class="line"><span>    a:   input  logic&lt;16&gt;,</span></span>
<span class="line"><span>    b:   input  logic&lt;16&gt;,</span></span>
<span class="line"><span>    sum: output logic&lt;17&gt;,</span></span>
<span class="line"><span>) {</span></span>
<span class="line"><span>    always_ff (clk, rst) {</span></span>
<span class="line"><span>        if_reset { sum = 0; }</span></span>
<span class="line"><span>        else     { sum = a + b; }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span></code></pre></div><p>↓ 生成</p><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Adder.d.ts (自動生成)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> interface</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> AdderPorts</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  /** input clock */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  readonly</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> clk</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Clock</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  /** input reset */</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  rst</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> number</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  /** input logic&lt;16&gt; — range: 0..65535 */</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  a</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> number</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  /** input logic&lt;16&gt; — range: 0..65535 */</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  b</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> number</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  /** output logic&lt;17&gt; — readonly */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  readonly</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> sum</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> number</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> declare</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Adder</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ModuleDefinition</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">AdderPorts</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;;</span></span></code></pre></div><h3 id="import-解決の選択肢" tabindex="-1">import 解決の選択肢 <a class="header-anchor" href="#import-解決の選択肢" aria-label="Permalink to &quot;import 解決の選択肢&quot;">​</a></h3><table tabindex="0"><thead><tr><th>方式</th><th>仕組み</th><th>メリット</th><th>デメリット</th></tr></thead><tbody><tr><td><strong>ビルドステップ生成</strong></td><td><code>veryl gen-ts</code> で <code>.d.ts</code> + <code>.js</code> を生成</td><td>シンプル、確実</td><td>手動実行が必要</td></tr><tr><td><strong>TypeScript plugin</strong></td><td>TS Language Service Plugin で <code>.veryl</code> を仮想解決</td><td>エディタ上で即時反映</td><td>実装が複雑</td></tr><tr><td><strong>Bun plugin</strong></td><td>Bun のローダーで <code>.veryl</code> を直接 import</td><td>ゼロ設定</td><td>Bun 依存</td></tr><tr><td><strong>watch モード</strong></td><td>ファイル変更を監視して自動再生成</td><td>IDE 補完とリアルタイム同期</td><td>プロセス常駐が必要</td></tr></tbody></table><p>初期実装としては <strong>ビルドステップ生成</strong> が最も現実的。将来的に watch モードや Bun plugin を追加する。</p><h2 id="シミュレータバックエンドの接続方式" tabindex="-1">シミュレータバックエンドの接続方式 <a class="header-anchor" href="#シミュレータバックエンドの接続方式" aria-label="Permalink to &quot;シミュレータバックエンドの接続方式&quot;">​</a></h2><p>TypeScript のテストベンチが Rust/Cranelift ベースのシミュレータエンジンを呼び出す方式:</p><table tabindex="0"><thead><tr><th>方式</th><th>概要</th><th>性能</th><th>移植性</th></tr></thead><tbody><tr><td><strong>NAPI (napi-rs)</strong></td><td>Node.js / Bun のネイティブアドオン</td><td>最高速（直接関数呼び出し）</td><td>Node.js + Bun</td></tr><tr><td><strong>WASM</strong></td><td>Cranelift バックエンドを WASM にコンパイル</td><td>良好（WASM オーバーヘッドあり）</td><td>どこでも動く</td></tr><tr><td><strong>FFI (Bun)</strong></td><td>Bun の <code>bun:ffi</code> で <code>.so</code> を直接ロード</td><td>NAPI に近い</td><td>Bun のみ</td></tr></tbody></table><p>推奨: <strong>NAPI</strong> を最初のターゲットとし、WASM を将来的なポータビリティオプションとして検討。</p><h2 id="ワークフロー全体像" tabindex="-1">ワークフロー全体像 <a class="header-anchor" href="#ワークフロー全体像" aria-label="Permalink to &quot;ワークフロー全体像&quot;">​</a></h2><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>1. ユーザーが .veryl ファイルを書く</span></span>
<span class="line"><span>2. veryl gen-ts を実行（または watch モードで自動実行）</span></span>
<span class="line"><span>3. .d.ts 型定義が生成される</span></span>
<span class="line"><span>4. テストベンチを .ts で記述（VSCode が型補完を提供）</span></span>
<span class="line"><span>5. bun test / vitest で実行</span></span>
<span class="line"><span>   → NAPI 経由でシミュレータエンジンが起動</span></span>
<span class="line"><span>   → JIT コンパイルされたネイティブコードで高速シミュレーション</span></span>
<span class="line"><span>6. VCD 波形を GTKWave 等で確認</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>┌──────────────┐    gen-ts     ┌──────────────┐</span></span>
<span class="line"><span>│  .veryl      │──────────────→│  .d.ts       │</span></span>
<span class="line"><span>│  (HDL src)   │               │  (型定義)     │</span></span>
<span class="line"><span>└──────────────┘               └──────┬───────┘</span></span>
<span class="line"><span>                                      │ import</span></span>
<span class="line"><span>                                      ▼</span></span>
<span class="line"><span>                               ┌──────────────┐</span></span>
<span class="line"><span>                               │  test.ts     │</span></span>
<span class="line"><span>                               │  (テストベンチ)│</span></span>
<span class="line"><span>                               └──────┬───────┘</span></span>
<span class="line"><span>                                      │ bun test / vitest</span></span>
<span class="line"><span>                                      ▼</span></span>
<span class="line"><span>                               ┌──────────────┐     NAPI      ┌──────────────┐</span></span>
<span class="line"><span>                               │  JS Runtime  │──────────────→│  Cranelift   │</span></span>
<span class="line"><span>                               │  (V8/Bun)    │               │  JIT Engine  │</span></span>
<span class="line"><span>                               └──────────────┘               └──────────────┘</span></span></code></pre></div><h2 id="cocotb-python-との比較" tabindex="-1">cocotb (Python) との比較 <a class="header-anchor" href="#cocotb-python-との比較" aria-label="Permalink to &quot;cocotb (Python) との比較&quot;">​</a></h2><table tabindex="0"><thead><tr><th></th><th>cocotb (Python)</th><th>Veryl TS Testbench</th></tr></thead><tbody><tr><td><strong>型安全性</strong></td><td>なし（実行時エラー）</td><td>完全（コンパイル時にポート名・幅を検証）</td></tr><tr><td><strong>IDE 補完</strong></td><td>限定的</td><td>フル補完（TS Language Server）</td></tr><tr><td><strong>実行速度</strong></td><td>CPython の制約</td><td>V8/Bun JIT + Cranelift JIT</td></tr><tr><td><strong>セットアップ</strong></td><td>VPI/VHPI + 外部シミュレータ必須</td><td><code>bun add @veryl-lang/simulator</code> のみ</td></tr><tr><td><strong>シミュレータ</strong></td><td>外部依存 (Verilator, VCS, etc.)</td><td>内蔵 (Cranelift JIT)</td></tr><tr><td><strong>デバッグ</strong></td><td>print + 波形</td><td>VS Code デバッガ + 波形</td></tr><tr><td><strong>テストランナー</strong></td><td>pytest</td><td>vitest / Jest / Bun test</td></tr><tr><td><strong>ホットリロード</strong></td><td>不可</td><td>可能 (vitest watch)</td></tr></tbody></table><h2 id="段階的な実装ロードマップ-概要" tabindex="-1">段階的な実装ロードマップ（概要） <a class="header-anchor" href="#段階的な実装ロードマップ-概要" aria-label="Permalink to &quot;段階的な実装ロードマップ（概要）&quot;">​</a></h2><h3 id="phase-1-基盤" tabindex="-1">Phase 1: 基盤 <a class="header-anchor" href="#phase-1-基盤" aria-label="Permalink to &quot;Phase 1: 基盤&quot;">​</a></h3><ul><li><code>veryl gen-ts</code> コマンドで <code>.d.ts</code> 型定義を生成</li><li>NAPI バインディングで <code>Simulator</code> / <code>Simulation</code> クラスを公開</li><li>基本的なプロパティアクセス（get/set）と <code>tick()</code></li></ul><h3 id="phase-2-開発体験" tabindex="-1">Phase 2: 開発体験 <a class="header-anchor" href="#phase-2-開発体験" aria-label="Permalink to &quot;Phase 2: 開発体験&quot;">​</a></h3><ul><li>vitest / Bun test との統合ガイド</li><li>VCD 出力サポート</li><li>4-state / wide value サポート</li><li>カスタム vitest マッチャー (<code>toBeX()</code> 等)</li></ul><h3 id="phase-3-高度な機能" tabindex="-1">Phase 3: 高度な機能 <a class="header-anchor" href="#phase-3-高度な機能" aria-label="Permalink to &quot;Phase 3: 高度な機能&quot;">​</a></h3><ul><li>watch モードによる型定義の自動再生成</li><li>Bun plugin による <code>.veryl</code> 直接 import</li><li>マルチクロック・時間ベースシミュレーションの TS API</li><li>パフォーマンスベンチマーク vs cocotb</li></ul><h3 id="phase-4-エコシステム" tabindex="-1">Phase 4: エコシステム <a class="header-anchor" href="#phase-4-エコシステム" aria-label="Permalink to &quot;Phase 4: エコシステム&quot;">​</a></h3><ul><li>npm パッケージとして公開 (<code>@veryl-lang/simulator</code>)</li><li>テンプレートプロジェクト (<code>create-veryl-test</code>)</li><li>ドキュメント・チュートリアル</li></ul></div></div></main><footer class="VPDocFooter" data-v-f11b51ce data-v-b4c0708c><!--[--><!--]--><!----><!----></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"api_index.md\":\"U4zfy3Lk\",\"api_index_classes_simulation.md\":\"CtBeim8I\",\"api_index_classes_simulator.md\":\"BrYMpCsu\",\"api_index_functions_fourstate.md\":\"Bpa3TDsa\",\"api_index_functions_isfourstatevalue.md\":\"DD3mJEBC\",\"api_index_index.md\":\"VXvCorKc\",\"api_index_interfaces_eventhandle.md\":\"C5x_K-aP\",\"api_index_interfaces_fourstatevalue.md\":\"B1PJnn86\",\"api_index_interfaces_moduledefinition.md\":\"C2XLrqJc\",\"api_index_interfaces_portinfo.md\":\"Cu7sHQn_\",\"api_index_interfaces_simulatoroptions.md\":\"0c7ZzNZx\",\"api_index_variables_x.md\":\"XALXq5GE\",\"api_matchers_functions_fourstateref.md\":\"BwyNXwyf\",\"api_matchers_functions_setupmatchers.md\":\"C7Fn4JLp\",\"api_matchers_index.md\":\"75gi81-N\",\"api_matchers_interfaces_fourstateref.md\":\"CaC_uA7f\",\"benchmarks_index.md\":\"BjieDwAv\",\"four_state_test_plan.md\":\"BcbH_-Xn\",\"guide_four-state.md\":\"CpEdytes\",\"guide_getting-started.md\":\"BgcNrqJg\",\"guide_introduction.md\":\"ZE7lQGM_\",\"guide_type-conversion.md\":\"Wa119iIV\",\"guide_writing-tests.md\":\"BQL8KTog\",\"index.md\":\"C3CQCJ7U\",\"internals_architecture.md\":\"B6UfULYI\",\"internals_cascade-limitations.md\":\"DtqG515p\",\"internals_combinational-analysis.md\":\"DTQhpJmm\",\"internals_four-state.md\":\"YsIxWppx\",\"internals_ir-reference.md\":\"BoqCh6CI\",\"internals_optimizations.md\":\"CRuocygj\",\"internals_status.md\":\"CIeUwIXt\",\"ja_benchmarks_index.md\":\"Cse9TDtG\",\"ja_guide_four-state.md\":\"BJgT3hVe\",\"ja_guide_getting-started.md\":\"Cqbfgp1Z\",\"ja_guide_introduction.md\":\"D-mrN6ID\",\"ja_guide_writing-tests.md\":\"CxlavYKK\",\"ja_index.md\":\"CvmoXuax\",\"ts_testbench_implementation_plan.md\":\"CuR5C3LK\",\"ts_testbench_vision.md\":\"CnKJOe6s\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"Celox\",\"description\":\"JIT simulator for Veryl HDL\",\"base\":\"/celox/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":\"dark\",\"themeConfig\":{\"nav\":[{\"text\":\"Guide\",\"link\":\"/guide/introduction\"},{\"text\":\"API\",\"link\":\"/api/\"},{\"text\":\"Internals\",\"link\":\"/internals/architecture\"},{\"text\":\"Benchmarks\",\"link\":\"/benchmarks/\"},{\"text\":\"GitHub\",\"link\":\"https://github.com/celox-sim/celox\"}],\"sidebar\":{\"/guide/\":[{\"text\":\"Guide\",\"items\":[{\"text\":\"Introduction\",\"link\":\"/guide/introduction\"},{\"text\":\"Getting Started\",\"link\":\"/guide/getting-started\"},{\"text\":\"Writing Tests\",\"link\":\"/guide/writing-tests\"},{\"text\":\"4-State Simulation\",\"link\":\"/guide/four-state\"},{\"text\":\"Type Conversion\",\"link\":\"/guide/type-conversion\"}]}],\"/api/\":[{\"text\":\"API Reference\",\"items\":[{\"text\":\"index\",\"link\":\"/api/index/\",\"collapsed\":true,\"items\":[{\"text\":\"Classes\",\"collapsed\":true,\"items\":[{\"text\":\"Simulation\",\"link\":\"/api/index/classes/Simulation.md\"},{\"text\":\"Simulator\",\"link\":\"/api/index/classes/Simulator.md\"}]},{\"text\":\"Interfaces\",\"collapsed\":true,\"items\":[{\"text\":\"EventHandle\",\"link\":\"/api/index/interfaces/EventHandle.md\"},{\"text\":\"FourStateValue\",\"link\":\"/api/index/interfaces/FourStateValue.md\"},{\"text\":\"ModuleDefinition\",\"link\":\"/api/index/interfaces/ModuleDefinition.md\"},{\"text\":\"PortInfo\",\"link\":\"/api/index/interfaces/PortInfo.md\"},{\"text\":\"SimulatorOptions\",\"link\":\"/api/index/interfaces/SimulatorOptions.md\"}]},{\"text\":\"Variables\",\"collapsed\":true,\"items\":[{\"text\":\"X\",\"link\":\"/api/index/variables/X.md\"}]},{\"text\":\"Functions\",\"collapsed\":true,\"items\":[{\"text\":\"FourState\",\"link\":\"/api/index/functions/FourState.md\"},{\"text\":\"isFourStateValue\",\"link\":\"/api/index/functions/isFourStateValue.md\"}]}]},{\"text\":\"matchers\",\"link\":\"/api/matchers/\",\"collapsed\":true,\"items\":[{\"text\":\"Interfaces\",\"collapsed\":true,\"items\":[{\"text\":\"FourStateRef\",\"link\":\"/api/matchers/interfaces/FourStateRef.md\"}]},{\"text\":\"Functions\",\"collapsed\":true,\"items\":[{\"text\":\"fourStateRef\",\"link\":\"/api/matchers/functions/fourStateRef.md\"},{\"text\":\"setupMatchers\",\"link\":\"/api/matchers/functions/setupMatchers.md\"}]}]}]}],\"/internals/\":[{\"text\":\"Internals\",\"items\":[{\"text\":\"Architecture\",\"link\":\"/internals/architecture\"},{\"text\":\"IR Reference\",\"link\":\"/internals/ir-reference\"},{\"text\":\"Optimizations\",\"link\":\"/internals/optimizations\"},{\"text\":\"4-State Simulation\",\"link\":\"/internals/four-state\"},{\"text\":\"Combinational Analysis\",\"link\":\"/internals/combinational-analysis\"},{\"text\":\"Cascade Limitations\",\"link\":\"/internals/cascade-limitations\"},{\"text\":\"Status\",\"link\":\"/internals/status\"}]}]},\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/celox-sim/celox\"}]},\"locales\":{\"root\":{\"label\":\"English\",\"lang\":\"en\"},\"ja\":{\"label\":\"Japanese\",\"lang\":\"ja\",\"themeConfig\":{\"nav\":[{\"text\":\"ガイド\",\"link\":\"/ja/guide/introduction\"},{\"text\":\"API\",\"link\":\"/api/\"},{\"text\":\"内部構造\",\"link\":\"/internals/architecture\"},{\"text\":\"ベンチマーク\",\"link\":\"/ja/benchmarks/\"},{\"text\":\"GitHub\",\"link\":\"https://github.com/celox-sim/celox\"}],\"sidebar\":{\"/ja/guide/\":[{\"text\":\"ガイド\",\"items\":[{\"text\":\"概要\",\"link\":\"/ja/guide/introduction\"},{\"text\":\"はじめる\",\"link\":\"/ja/guide/getting-started\"},{\"text\":\"テストの書き方\",\"link\":\"/ja/guide/writing-tests\"},{\"text\":\"4 値シミュレーション\",\"link\":\"/ja/guide/four-state\"}]}]}}}},\"scrollOffset\":134,\"cleanUrls\":false}");</script>
    
  </body>
</html>